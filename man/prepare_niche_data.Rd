% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/prepare_niche_data.R
\name{prepare_niche_data}
\alias{prepare_niche_data}
\title{Prepare Niche Data for Analysis}
\usage{
prepare_niche_data(
  occurrences_gpkg_path,
  raster_dir_path = NULL,
  categorical_var_names = NULL,
  scientific_name_col = "scientificName",
  genus_col_name = "Genus",
  species_col_name = "Species",
  species_id_col = "species_id",
  min_occurrences_per_species = 10,
  continuous_var_labels = list(),
  categorical_var_labels = list(),
  trophic_mode_col = NULL,
  filtered_trophic_modes = NULL,
  genera_to_exclude = NULL
)
}
\arguments{
\item{occurrences_gpkg_path}{Character. Path to the GPKG file containing species occurrences.
The GPKG must contain point geometries.}

\item{raster_dir_path}{Character. Path to the directory containing environmental raster files (TIF format).}

\item{categorical_var_names}{Character vector. Names of the environmental variables
(matching raster layer names without .tif extension) that should be treated as categorical.}

\item{scientific_name_col}{Character. Name of the column in the GPKG's attribute table
containing the full scientific name (e.g., "Genus species"). Used if `genus_col_name`
and `species_col_name` are not found or not provided. Default is "scientificName".}

\item{genus_col_name}{Character. Optional. Name of the column for Genus.
If provided and found, this column will be used. Otherwise, the function
attempts to find a column named "Genus", or derive it from `scientific_name_col`.
Default is "Genus".}

\item{species_col_name}{Character. Optional. Name of the column for the specific epithet.
If provided and found, this column will be used. Otherwise, the function
attempts to find a column named "Species", or derive it from `scientific_name_col`.
Default is "Species".}

\item{species_id_col}{Character. Name of the column that will be created (or used if existing and correctly formatted) by combining
Genus and Species (e.g., "Genus_species"). Default is "species_id".}

\item{min_occurrences_per_species}{Integer. Minimum number of valid occurrences for a
species to be retained in the final dataset. Default is 10.}

\item{continuous_var_labels}{Named list. Optional. Custom display labels for continuous variables.
Example: `list(bio1 = "Annual Mean Temp", aspect = "Aspect (degrees)")`.
Variable names in the list must match raster layer names.}

\item{categorical_var_labels}{Named list of named vectors/lists. Optional. Custom display labels for
categorical variable levels. Example:
`list(SoilType = c("1" = "Sandy", "2" = "Clay"), LandCover = c("1" = "Quercus ilex Forest", "2" = "Pinus radiata Forest))`.
Variable names in the list must match categorical raster layer names.}

\item{trophic_mode_col}{Character. Optional. Name of the column in the GPKG containing
trophic mode information.}

\item{filtered_trophic_modes}{Character vector. Optional. If `trophic_mode_col` is provided,
only occurrences with these trophic modes will be kept.}

\item{genera_to_exclude}{Character vector. Optional. List of genera to exclude from the analysis.
Default is NULL.}
}
\value{
A list object of class `niche_data` containing:
  \item{data}{A tibble with processed occurrence data, extracted environmental values,
              the site ID column, and the species ID column.}
  \item{metadata}{A list containing information about the processed data:
    \itemize{
      \item `site_id_col`: Name of the site ID column.
      \item `genus_col_name_processed`: Name of the genus column used/created.
      \item `species_epithet_col_name_processed`: Name of the species epithet column used/created.
      \item `species_id_col`: Name of the species ID column.
      \item `occurrence_crs`: Original CRS of the occurrence data.
      \item `env_vars`: A list with names of all, continuous, and categorical environmental variables used.
      \item `labels`: A list containing `continuous_var_labels` and `categorical_var_labels` (merged user input with defaults).
      \item `categorical_vars_info`: A list where each element is a categorical variable name,
             and its value is a named vector of its levels and their labels.
      \item `parameters_used`: A list of key parameters used during data preparation.
    }}
  \item{raster_stack_info}{Information about the loaded raster stack (e.g., names, resolution, extent),
                           or NULL if no raster layers were processed.}
}
\description{
This function loads species occurrence data (GPKG) and environmental raster layers,
processes them, and returns a structured object ready for niche analysis.
}
\examples{
\dontrun{
  # Assuming you have:
  # occurrences.gpkg in "path/to/data"
  # raster_layers/ (containing bio1.tif, soil_type.tif) in "path/to/data"

  niche_object <- prepare_niche_data(
    occurrences_gpkg_path = "path/to/data/occurrences.gpkg",
    raster_dir_path = "path/to/data/raster_layers/",
    categorical_var_names = c("soil_type"),
    scientific_name_col = "nome_scientifico", # if different from default
    genus_col_name = "genus",             # if different from default
    species_col_name = "species",           # if different from default
    min_occurrences_per_species = 5,
    continuous_var_labels = list(bio1 = "Annual Mean Temperature (Â°C)"),
    categorical_var_labels = list(soil_type = c("1" = "Sandy Loam", "2" = "Clay Loam"))
  )

  # Access the processed data
  # head(niche_object$data)
  # print(niche_object$metadata$env_vars)
}
}
