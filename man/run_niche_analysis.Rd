% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/run_analysis.R
\name{run_niche_analysis}
\alias{run_niche_analysis}
\title{Run Niche Analysis Workflow}
\usage{
run_niche_analysis(
  niche_data_object,
  analysis_settings,
  output_dir,
  verbose = TRUE
)
}
\arguments{
\item{niche_data_object}{An object of class 'niche_data_object' (output from \code{\link{prepare_niche_data}}).}

\item{analysis_settings}{An object of class 'niche_analysis_settings' (output from \code{\link{set_analysis_settings}}).}

\item{output_dir}{Character. Path to the main directory where all outputs (CSVs, plots, reports) will be saved.
Subdirectories for each target species will be created here.}

\item{verbose}{Logical. If TRUE, prints progress messages to the console. Default is TRUE.}
}
\value{
A list (invisibly) containing detailed results for each target species analyzed.
        The primary output is written to files in the specified `output_dir`.
}
\description{
Orchestrates the complete niche analysis workflow based on prepared data
and user-defined settings.
}
\examples{
\dontrun{
# --- 0. Define Paths and Basic Parameters ---
my_gpkg_path <- "path/to/your/occurrences.gpkg" # MODIFY
my_raster_dir <- "path/to/your/raster_layers/"  # MODIFY
my_output_dir <- "path/to/your/analysis_output/" # MODIFY

# Ensure output directory exists
if (!dir.exists(my_output_dir)) {
  dir.create(my_output_dir, recurive = TRUE)
}

# --- 1. Prepare Niche Data ---
# Assuming 'SoilType' and 'LandCover' are categorical raster layers in my_raster_dir
# and the GPKG has 'scientificName', 'Genus', 'Species' columns.
prepared_niche_data <- prepare_niche_data(
  occurrences_gpkg_path = my_gpkg_path,
  raster_dir_path = my_raster_dir,
  categorical_var_names = c("SoilType", "LandCover"), # Names of categorical rasters
  scientific_name_col = "scientificName",
  genus_col_name = "Genus",
  species_col_name = "Species",
  min_occurrences_per_species = 10,
  continuous_var_labels = list(bio1 = "Annual Mean Temperature (Â°C)"),
  categorical_var_labels = list(SoilType = c("1" = "Sandy", "2" = "Clay"))
)

# Check if data preparation was successful
if (!is.null(prepared_niche_data) && nrow(prepared_niche_data$data) > 0) {

  # --- 2. Set Analysis Settings ---
  # Example: Analyze Tuber aestivum and all species of Quercus genus
  # using Boruta, generating plots for the top 5 closest species.
  analysis_configuration <- set_analysis_settings(
    target_species = "Tuber_aestivum", # Example target species
    target_genera = "Quercus",         # Example target genus
    exclude_congenerics_if_species_target = TRUE,
    analyses_to_run = c("overlap_indices", "permanova_pairwise", "lda_multigroup", "dendrogram_global_hv", "enfa"),
    variable_selection_method = "Boruta",
    boruta_max_confirmed_vars = 5,
    generate_plots = TRUE,
    plot_type = "n_closest_species",
    plot_n_closest = 5,
    plot_n_closest_overlap_metric = "mean_schoener_D",
    enfa_run_for_closest_species = TRUE, # Set to TRUE to run ENFA on closest species
    enfa_n_closest = 3,                  # Number of closest species for ENFA
    enfa_plot_presence_points = TRUE,    # Whether to plot the cloud of presence points
    generate_report = TRUE,
    continuous_dist_plot_type = "ridgeline",
    plot_categorical_distributions = TRUE
  )

  # --- 3. Run the Niche Analysis ---
  analysis_results <- run_niche_analysis(
    niche_data_object = prepared_niche_data,
    analysis_settings = analysis_configuration,
    output_dir = my_output_dir,
    verbose = TRUE
  )

  # The 'analysis_results' object (returned invisibly) contains detailed outputs.
  # All primary outputs (CSVs, plots, reports) are saved in 'my_output_dir'.

} else {
  message("Niche data preparation failed or resulted in no data. Analysis cannot proceed.")
}
}
}
